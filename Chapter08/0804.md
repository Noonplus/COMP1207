## การประยุกต์ใช้คำสั่งจัดการแฟ้มข้อมูล

ชุดคำสั่งในการจัดการแฟ้มข้อมูล ประกอบไปด้วย คำสั่งเปิดแฟ้มข้อมูล คำสั่งอ่านและเขียนแฟ้มข้อมูล และคำสั่งปิดแฟ้มข้อมูล ซึ่งการประยุกต์ใช้งานคำสั่งเบื้องต้นมีดังนี้

```
01:#include <stdio.h>
02:main() {
03:   FILE *fp;
04:   fp = fopen ("product.txt", "r");
05:   if(fp == NULL) {                             // ถ้าไม่สามารถเปิดแฟ้มข้อมูลได้ 
06:       printf("File not exist\n");            // แสดงข้อความว่า File not exist
07:   } else {
08:       fclose(fp);
09:   }
10:}
```
[ดาวน์โหลด source code](src/ch08_06.cpp)

จากโปรแกรม บรรทัดที่ 04 เป็นการใช้คำสั่ง fopen() เพื่อเปิดแฟ้มข้อมูลที่ชื่อว่า product.txt ที่มีการอ้างอิงด้วยตัวแปรพอยน์เตอร์ fp จากนั้นจึงได้ทำการตรวจสอบสถานะการอ้างอิงด้วยเงื่อนไข ตามบรรทัดที่ 05 และบรรทัดที่ 06 ซึ่งในที่นี้พอยน์เตอร์ fp มีค่าเท่ากับ NULL (ค่าว่าง) หมายความว่า ถ้าพอยน์เตอร์ fp ไม่สามารถอ้างอิงการเปิดแฟ้มข้อมูล product.txt ได้ แสดงว่าอาจจะไม่มีแฟ้มข้อมูลนั้นอยู่ในระบบคอมพิวเตอร์ ซึ่งหากเงื่อนไขดังกล่าวเป็นจริง จะได้ผลลัพธ์ ดังนี้

```
01:File not exist
```

แสดงวิธีการเขียนไฟล์ด้วยคำสั่ง putc()

```
01:#include <stdio.h>
02:main() {
03:    char name[] = "Wanda Maximoff";                    
04:    FILE *fp = fopen("name.txt", "w");         // เปิดแฟ้มข้อมูล name.txt เพื่อเขียนทับ           
05:    for(int i = 0; i < sizeof(name)-1; i++) {  /// วนรอบ   
06:        putc(name[i], fp);                     // เขียนอักขระ name[i]                            
07:    }                  // ไปยังแฟ้มข้อมูล name.txt ที่เปิดไว้
08:    fclose(fp);        // ปิดแฟ้มข้อมูล                                          
09:}	
```
[ดาวน์โหลด source code](src/ch08_07.cpp)

จากโปรแกรม บรรทัดที่ 05 คำสั่ง for(int i = 0; i < sizeof(name)-1; i++) เป็นการวนรอบเขียนค่าอักขระ name[i] โดยที่ i มีค่าเริ่มต้นเท่ากับ 0 ถึง sizeof(name)-1 เพื่อเก็บจำนวนอักขระของตัวแปร name เข้าไปยังแฟ้มข้อมูล name.txt ผ่านการใช้คำสั่ง putc() ครั้งละ 1 ตัวอักษร ซึ่งผลลัพธ์ที่เขียนไปยังแฟ้มข้อมูล ดังภาพ

<img src=img/0807.png>

จากภาพแสดงข้อมูลที่ได้จัดเก็บในแฟ้มข้อมูล name.txt ที่ถูกสร้างและเขียนข้อความลงไปในแฟ้มข้อมูลด้วยโปรแกรมที่ 8.7 โดยสามารถอ่านข้อมูลจากแฟ้มข้อมูลดังกล่าวเพื่อนำมาแสดงผลบนจอภาพด้วยคำสั่ง getc() ได้ตามตัวอย่างโปรแกรม

```
01:#include <stdio.h>
02:main() {
03:    char ch;                    
04:    FILE *fp = fopen("name.txt", "r");    // เปิดแฟ้มข้อมูล name.txt เพื่ออ่าน  
05:    do {                        /// วนรอบ                 
06:        ch = getc(fp);          // อ่านค่าอักขระจากแฟ้มข้อมูลไว้ที่ตัวแปร ch                    
07:        printf("%c", ch);       // แสดงค่าอักขระ ch บนจอภาพ                     
08:    } while(ch != EOF);         // วนรอบเมื่อตัวอักขระ ch ไม่เท่ากับ EOF            
09:    fclose(fp);                 // ปิดแฟ้มข้อมูล                
10:}
```
[ดาวน์โหลด source code](src/ch08_08.cpp)

จากโปรแกรม คำสั่งบรรทัดที่ 04 ```FILE *fp = fopen("name.txt", "r");``` เป็นการเปิดเปิดแฟ้มข้อมูลชื่อว่า name.txt อ้างอิงด้วยตัวแปรพอยน์เตอร์ fp โดยแฟ้มข้อมูลดังกล่าวมีข้อความ “Wanda Maximoff” ที่ถูกบันทึกไว้ และในคำสั่งบรรทัดที่ 06 เป็นการอ่านค่าด้วยคำสั่ง getc() ซึ่งสามารถอ่านค่าได้ครั้งละ 1 ตัวอักษร เพื่อมาแสดงบนจอภาพจนครบทุกตัวอักษร โดยโปรแกรมวนรอบเพื่ออ่านค่าอักขระมาเก็บไว้ตัวแปรอักขระ ch พร้อมกับแสดงที่อ่านค่าได้ไปบนจอภาพครั้งละ 1 ตัวอักษรไปเรื่อย ๆ จนกระทั่งพบว่า ค่าตัวอักษรของตัวแปร ch ที่อ่านได้มีค่าเท่ากับ EOF (End of File) ซึ่งเป็นรหัสอักขระที่กำกับปิดท้ายเพื่อบอกตำแหน่งสิ้นสุดข้อมูลของแฟ้มข้อมูล ในบรรทัดที่ 08 จึงสิ้นสุดการวนรอบ ดังนั้นจากการทำงานของโปรแกรมจึงให้ผลลัพธ์ ดังนี้

```
01:Wanda Maximoff
```

แสดงวิธีเขียน-อ่าน ข้อมูลตามรูปแบบที่กำหนด

```
01:#include <stdio.h>
02:main() {       
03:    char stdCode[] = "9999999999";
04:    char stdName[] = "Peter";
05:    char stdSurname[] = " Parker";
06:    int stdAge = 16;
07:    FILE *fp = fopen("student.txt", "w");        /// เปิดแฟ้มข้อมูลเพื่อเขียนทับ                          
08:    fprintf(fp, "%s %s %s %d", stdCode, stdName, stdSurname, stdAge);  
09:     ///เขียนแฟ้มข้อมูลตามรูปแบบ                             
10:    fclose(fp);                                 ///  ปิดแฟ้มข้อมูล                                                                   
11:    fp = fopen("student.txt", "r");                /// เปิดแฟ้มข้อมูลเพื่ออ่าน                          
12:    fscanf(fp, "%s %s %s %d", stdCode, stdName, stdSurname, &stdAge); 
13:      /// อ่านแฟ้มข้อมูลตามรูปแบบ 
14:    printf("%s\n", stdCode);                                         
15:    printf("%s %s \n", stdName, stdSurname);  ///   แสดงผลลัพธ์                                      
16:    printf("%.d\n", stdAge);                                        
17:    fclose(fp);                               ///  ปิดแฟ้มข้อมูล                                        
18:}
```
[ดาวน์โหลด source code](src/ch08_09.cpp)

จากโปรแกรม แสดงถึงขั้นตอนการจัดการแฟ้มข้อมูลตามรูปแบบที่กำหนด ซึ่งประกอบด้วย 3 ขั้นตอน ได้แก่ คำสั่งในบรรทัด 07 เป็นคำสั่งในการเปิดแฟ้มข้อมูลเพื่อเขียน ในที่นี้เป็นการเปิดแฟ้มข้อมูล student.txt คำสั่งในบรรทัดที่ 08 เป็นคำสั่งในการเขียนแฟ้มข้อมูลตามรูปแบบ ในที่นี้ได้เขียนข้อมูลค่าของตัวแปรทั้ง 4 ตัวแปรที่ได้ประกาศพร้อมกำหนดค่าเริ่มต้นให้กับตัวแปรในบรรทัดที่ 03 ถึงบรรทัดที่ 06 ดังนี้ ตัวแปรข้อความรหัส stdCode = “9999999999” ตัวแปรข้อความชื่อ stdName = “Peter” ตัวแปรข้อความนามสกุล stdSurname = “Parker” และตัวแปรจำนวนเต็มอายุ stdAge = 16 ด้วยคำสั่ง fprintf() ไปยังแฟ้มข้อมูล student.txt และคำสั่งในบรรทัดที่ 10 เป็นคำสั่งในการปิดแฟ้มข้อมูล  การใช้คำสั่ง fprintf() จากบรรดทัดที่ 08 เป็นการเขียนข้อมูลตามรูปแบบ "%s %s %s %d" ด้วยค่าของตัวแปร รหัสนักศึกษา (stdCode) ชื่อ (stdName) นามสกุล (stdSurname) และ อายุ (stdAge) ไปยังแฟ้มข้อมูล student.txt ดังกล่าว จะได้ผลลัพธ์ที่เขียนไปยังแฟ้มข้อมูล ดังภาพ

<img src=img/0808.png>

การแสดงผลลัพธ์บนจอภาพจากโปรแกรมที่ 8.9 จะประกอบด้วย 4 ขั้นตอน ได้แก่ เปิดแฟ้มข้อมูลเพื่ออ่าน การอ่านแฟ้มข้อมูลตามรูปแบบ การแสดงผลลัพธ์ และการปิดแฟ้มข้อมูล โดยเริ่มจากคำสั่งบรรทัดที่ 11 เป็นคำสั่งในการเปิดแฟ้มข้อมูลเพื่อการอ่าน ในที่นี้จะทำการเปิดแฟ้มข้อมูล student.txt ที่ถูกสร้างและเขียนข้อความลงไปในแฟ้มข้อมูล ในบรรทัดที่ 12 จะใช้คำสั่ง fscanf() เพื่ออ่านข้อมูลตามรูปแบบ "%s %s %s %d" โดยจะนำค่าที่อ่านได้ไปจัดเก็บยังตัวแปรรหัสนักศึกษา (stdCode) ชื่อ (stdName) นามสกุล (stdSurname) และ อายุ (stdAge) การแสดงผลบนจอภาพจะใช้คำสั่ง printf() ซึ่งสามารถเขียนได้ตามบรรทัดที่ 15 ถึง บรรทัดที่ 16 และคำสั่งในบรรทัดที่ 17เป็นคำสั่งในการปิดแฟ้มข้อมูล จากโปรแกรม มีผลการทำงานของโปรแกรมจะปรากฏบนจอภาพ ดังนี้

```
01:9999999999
02:Peter Parker
03:16	
```

แสดงวิธีการเขียน-อ่านข้อมูลโครงสร้าง

```
01:#include <stdio.h>
02:#include <string.h>
03:typedef struct { 
04:    char name[50]; 
05:    int expYear; 
06:    float salary; 
07:} EMPLOYEE;  
08:main() {
09:    /// ประกาศและแทนค่าให้กับตัวแปรโครงสร้าง
10:    EMPLOYEE writeEmp, readEmp; // ประกาศตัวแปร ตามโครงสร้าง EMPLOYEE
11:    strcpy(writeEmp.name, "Wanda Maximoff"); 
12:    writeEmp.expYear = 15;  
13:    writeEmp.salary = 35000.00;
14:    /// ส่วนเขียนแฟ้มข้อมูล
15:    FILE *fp = fopen("employee.dat", "w");   
16:    fwrite(&writeEmp, sizeof(EMPLOYEE), 1,  fp);  
17:    fclose(fp);           
18:    /// ส่วนอ่านแฟ้มข้อมูล
19:    fp = fopen("employee.dat", "r");          
20:    fread(&readEmp, sizeof(EMPLOYEE), 1,  fp);    
21:    printf("%s\n", readEmp.name);             
22:    printf("%d\n", readEmp.expYear);          
23:    printf("%.2f\n", readEmp.salary);           
24:    fclose(fp);              
25:}
```
[ดาวน์โหลด source code](src/ch08_10.cpp)

จากโปรแกรมแสดงวิธีการเขียน-อ่านข้อมูลไปยังแฟ้มข้อมูลในรูปแบบโครงสร้าง โดยส่วนหัวโปรแกรม (บรรทัดที่ 04 ถึง บรรทัดที่ 07) เป็นการประกาศชนิดโครงสร้างข้อมูลเพื่อใช้สำหรับจัดเก็บข้อมูลพนักงาน  โดยใช้ชื่อว่า EMPLOYEE ที่มีการประกาศตัวแปรเพื่อการจัดเก็บข้อมูลพร้อมการกำหนดค่าเริ่มต้น ประกอบด้วย  ตัวแปรข้อความ name = “ ” ตัวแปรจำนวนเต็ม expYear = 0 และ ตัวแปรจำนวนจริง salary = 0.00 คำสั่งในบรรทัดที่ 10 เป็นการประกาศตัวแปรเพื่อใช้งานตามโครงสร้าง โดยจะใช้คำสั่ง writeEmp ในการเขียนโครงสร้างข้อมูลและค่าเริ่มต้นตามที่กำหนดไปยังแฟ้มข้อมูล employee.dat และ การอ่านข้อมูลจากแฟ้มข้อมูล employee.dat ที่มีการจัดเก็บข้อมูลตามโครงสร้าง EMPLOYEE จะใช้คำสั่ง readEmp การเขียนโปรแกรมเพื่อเขียน-อ่านข้อมูลตามโครงสร้างประกอบด้วย 4 ขั้นตอน ได้แก่ การกำหนดค่าใหม่ให้ตัวแปร การเปิดแฟ้มข้อมูลเพื่อเขียน การเขียนแฟ้มข้อมูล และการ ปิดแฟ้มข้อมูล ดังคำสั่งในบรรทัดที่ 11 ถึง บรรทัดที่ 17 โดยมีรายละเอียดดังนี้

```
11:	                                                               /// 1. กำหนดค่าใหม่ให้ตัวแปร
12:strcpy(writeEmp.name, “Wanda Maximoff”);   // name = “Wanda Maximoff”
13:writeEmp.expYear = 15;                                // expYear = 15
14:writeEmp.salary = 35000.00;                         // salary = 35000.00
15:FILE *fp = fopen("employee.dat", "w");             /// 2. เปิดแฟ้มข้อมูลเพื่อเขียนทับ
16:fwrite(&writeEmp, sizeof(EMPLOYEE), 1,  fp);    /// 3. เขียนแฟ้มข้อมูล
17:fclose(fp);                                                 /// 4. ปิดแฟ้มข้อมูล
```

การเขียนโปรแกรมประกอบด้วย 4 ขั้นตอน ได้แก่ การเปิดแฟ้มข้อมูลเพื่ออ่าน การอ่านแฟ้มข้อมูล การแสดงผลลัพธ์ และการปิดแฟ้มข้อมูล ดังคำสั่งในบรรทัดที่ 19 ถึงบรรทัดที่ 24 โดยมีรายละเอียดดังนี้

```
19:fp = fopen("employee.dat", "r");                      /// 1. เปิดแฟ้มข้อมูลเพื่ออ่าน
20:fread(&tempEmp, sizeof(EMPLOYEE), 1,  fp);     /// 2. อ่านแฟ้มข้อมูล 
21:printf("%s\n", readEmp.name);                       // ///////////////////////////////
22:printf("%d\n", readEmp.expYear);                   /// 3. แสดงผลลัพธ์
23:printf("%.2f\n", readEmp.salary);                    // ///////////////////////////////
24:fclose(fp);                                                /// 4. ปิดแฟ้มข้อมูล employee.txt
```

จากตัวอย่างโปรแกรม มีผลการทำงานของโปรแกรมจะปรากฏบนจอภาพ ดังนี้

```
01:Wanda Maximoff
02:10
03:35000.00	
```
---
#### [<< หน้าก่อนหน้า](0803.md) | [หน้าเลือกหัวข้อ](README.md) | [หน้าต่อไป >>](0810.md)
---
