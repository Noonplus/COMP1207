## การจัดการแฟ้มข้อมูล
 	
แฟ้มข้อมูลเป็นรูปแบบข้อมูลหรือเอกสารทางคอมพิวเตอร์ ถูกบันทึกและจัดเก็บไว้ในหน่วยความจำสำรอง อาทิ ฮาร์ดดิสก์ ซึ่งแฟ้มข้อมูลจะเป็นกลุ่มของข้อมูลที่สัมพันธ์กันที่ประกอบด้วย ระเบียน (Record) ตั้งแต่ 1 ระเบียน เขตของข้อมูล (Field) ที่มีชนิดแตกต่างกัน และจะมีสัญลักษณ์ที่แสดงถึงการจบแฟ้มข้อมูล (End of File: EOF)  อยู่ต่อท้าย โดยทั่วไปภาษาคอมพิวเตอร์ระดับสูงจะมีชุดคำสั่งในการจัดการแฟ้มข้อมูล ซึ่งจะประกอบด้วย คำสั่งเปิดแฟ้มข้อมูล คำสั่งปิดแฟ้มข้อมูล และคำสั่งเขียน/อ่านแฟ้มข้อมูล ทำให้นักพัฒนาโปรแกรมสามารถใช้แฟ้มข้อมูลเพื่อช่วยในการบันทึกจัดเก็บข้อมูลต่าง ๆ ของโปรแกรมและสามารถนำข้อมูลดังกล่าวกับมาทำงานได้ในครั้งต่อไป 

### ฟังก์ชันจัดการแฟ้มข้อมูล
หลักการพื้นฐานของฟังก์ชันจัดการแฟ้มข้อมูล สามารถแบ่งออกเป็น ประกอบด้วย 3 กลุ่มคำสั่งฟังก์ชันที่ใช้สำหรับจัดการไฟล์ที่สำคัญของภาษาซี ได้แก่ คำสั่งเปิดแฟ้มข้อมูล คำสั่งปิดแฟ้มข้อมูล และกลุ่มคำสั่งเขียน/อ่านแฟ้มไฟล์ โดยคำสั่งทั้งหมดได้ถูกนิยามไว้ในไลบรารี stdio.h แสดงดังภาพ

<img src=img/0806.png>

### การใช้งานแฟ้มข้อมูล
การใช้งานแฟ้มข้อมูลมีวัตถุประสงค์เพื่อจัดเก็บข้อมูลในระบบคอมพิวเตอร์แบบถาวร ซึ่งมีความแตกต่างจากการใช้งานตัวแปรทั่วไป ที่มักจะถูกประกาศเพื่อใช้งานชั่วคราวบนหน่วยความจำหลักของเครื่องคอมพิวเตอร์ ตัวแปรทั่วไปสามารถใช้งานในขณะที่โปรแกรมกำลังเปิดหรือทำงานอยู่เท่านั้น เมื่อปิดโปรแกรมข้อมูลต่าง ๆ ที่จัดเก็บบนหน่วยความจำจะหายไปพร้อมกับโปรแกรมนั้น ๆ ดังนั้น หากนักพัฒนาโปรแกรมต้องการบันทึกหรือจัดเก็บข้อมูลจากตัวแปรเหล่านั้นเอาไว้ในระบบคอมพิวเตอร์เพื่อให้สามารถเรียกกลับมาใช้งานได้ใหม่ในครั้งต่อไป ต้องใช้งานกลุ่มคำสั่งประเภทจัดการแฟ้มข้อมูลเพื่อทำการบันทึกข้อมูลจากหน่วยความจำหลักไปยังหน่วยความจำสำรองในรูปแบบไฟล์หรือแฟ้มข้อมูล การใช้งานแฟ้มข้อมูลของภาษาซีจะใช้วิธีอ้างอิงข้อมูลจากไฟล์ผ่านตัวแปรพอยน์เตอร์ โดยตัวแปรพอยน์เตอร์ดังกล่าวมีหน้าที่อ้างอิงตำแหน่งไฟล์ที่ถูกเปิดใช้งานบนหน่วยความจำขณะนั้น สามารถประกาศตัวแปรพอยน์เตอร์สำหรับการอ้างอิงไฟล์ โดยใช้รูปแบบคำสั่ง ดังนี้

```
FILE *ชื่อตัวแปรพอย์เตอร์;
```

โดยที่ ชนิดแบบ FILE ได้มีการนิยามไว้ในไลบรารี stdio.h นักพัฒนาโปรแกรมสามารถประกาศตัวแปรพอยน์เตอร์สำหรับใช้ในการอ้างอิงการเปิดใช้งานไฟล์ ตัวอย่างเช่น

```
01:FILE *fp;	// fp คือ พอยน์เตอร์อ้างอิงไฟล์
```

จากตัวอย่างตัวแปร fp คือ ตัวแปรพอยน์เตอร์ชนิดแบบ FILE มีหน้าที่สำหรับใช้เป็นตัวชี้ไปยังตำแหน่งของไฟล์ที่เปิดขึ้นเพื่อทำงานขณะนั้น

### คำสั่งเปิดแฟ้มข้อมูล
การทำงานเกี่ยวกับแฟ้มข้อมูลไม่ว่าจะเป็นการอ่าน หรือการเขียนข้อมูลในแฟ้มข้อมูล ต้องเริ่มต้นด้วยการเปิดแฟ้มข้อมูลเสมอ สำหรับการเปิดใช้งานไฟล์ต่าง ๆ ในภาษาซีจะใช้คำสั่ง fopen() มีรูปแบบโครงสร้างคำสั่ง ดังนี้

```
พอยน์เตอร์อ้างอิง = fopen("ชื่อไฟล์ที่ต้องการเปิด", "ประเภทการเปิด");
```

โดย ชื่อไฟล์ที่ต้องการเปิด เป็นการระบุชื่อไฟล์หรือแฟ้มข้อมูล อาทิ student.txt ส่วน ประเภทการเปิด เป็นการระบุรหัสให้ตรงตามวัตถุประสงค์ของการเปิดใช้งานไฟล์ ตัวอย่างการใช้คำสั่งเปิดไฟล์ เช่น

```
01:FILE *fp;
02:fp = fopen("student.txt", "r");        // เปิดไฟล์ student.txt แบบอ่านอย่างเดียว
```
หมายเหตุ: ตำแหน่งแฟ้มข้อมูล student.txt อยู่ที่เดียวกับต้นฉบับโปรแกรม

จากตัวอย่างข้างต้น คำสั่ง fopen() ใช้สำหรับการเปิดไฟล์ที่ชื่อว่า student.txt โดยมีจุดประสงค์ในการเปิดไฟล์แบบ r ซึ่งเป็นการเปิดเพื่ออ่านอย่างเดียว ทั้งนี้สามารถกำหนดรูปแบบการเปิดไฟล์ตามจุดประสงค์การใช้งานอื่น ๆ แสดงรายละเอียดตาม ดังตาราง

<img src=img/0800-1.png>

จากตารางแสดงรายการรหัสจุโหมดของการเปิดใช้งานแฟ้มข้อมูลและความหมาย สำหรับกรณีที่ใช้รหัสเปิดเพื่อเขียนไฟล์ เช่น เปิดแบบ w แต่ในคอมพิวเตอร์ไม่มีไฟล์ชื่อนั้นปรากฏอยู่ คอมไพเลอร์จะสร้างแฟ้มข้อมูลว่างตามชื่อที่ระบุขึ้นมาให้ใหม่เพื่อใช้ดำเนินการต่อไป

### คำสั่งปิดแฟ้มข้อมูล
เมื่อทำงานกับแฟ้มข้อมูลเสร็จเรียบร้อยแล้ว ไม่ว่าจะเป็นการอ่านหรือการเขียนแฟ้มข้อมูลก็ตาม ขั้นตอนสุดท้ายนักพัฒนาโปรแกรมควรทำการปิดแฟ้มข้อมูลนั้น ๆ เสมอ เพื่อบันทึกข้อมูลปรับปรุงล่าสุดไปยังหน่วยความจำสำรอง และทำการคืนค่าทรัพยากรพื้นที่หน่วยความจำที่ใช้ในให้กับระบบคอมพิวเตอร์ สำหรับคำสั่งปิดไฟล์ของภาษาซีใช้คำสั่ง fclose() โดยมีรูปแบบการใช้คำสั่ง ดังนี้

```
fclose(ชื่อพอยน์เตอร์อ้างอิง);
```

โดย ชื่อพอยน์เตอร์อ้างอิง หมายถึง ชื่อตัวแปรที่ใช้ในการอ้างอิงการเปิดไฟล์ทำงานตัวอย่างเช่น หากอ้างอิงการเปิดไฟล์ด้วยพอยน์เตอร์ fp สามารถสั่งปิดไฟล์ด้วยคำสั่ง ดังนี้

```
01:FILE *fp;
02:fp = fopen("student.txt", "r");        // เปิดไฟล์ student.txt แบบอ่านอย่างเดียว
03:fclose(fp);
```

### คำสั่งเขียน/อ่านแฟ้มข้อมูล
การใช้คำสั่งเขียน/อ่านแฟ้มข้อมูล ประกอบไปด้วย ชุดคำสั่งเขียน/อ่านทีละอักขระ ชุดคำสั่งเขียน/อ่านตามรูปแบบบังคับ และชุดคำสั่งเขียน/อ่านข้อมูลแบบโครงสร้าง ซึ่งรูปแบบการใช้งานคำสั่งและตัวอย่างการเขียนคำสั่ง มีรายละเอียดดังนี้

#### 1.  คำสั่งเขียนอักขระทีละตัวอักษร
คำสั่ง putc() สำหรับเขียนข้อมูลไปยังไฟล์ครั้งละ 1 ตัวอักขระ ซึ่งจะใช้ในกรณีที่ต้องการเขียนตัวอักขระโดยตรง มีรูปแบบคำสั่งดังนี้

```
putc('ตัวอักขระ', ชื่อพอยน์เตอร์อ้างอิง);
```

โดยที่ ตัวอักขระ เป็นการระบุตัวอักษร เช่น อักษร 'A' หรืออาจจะเป็นรหัสบังคับพิมพ์อักขระ เช่น '\n' (ขึ้นบรรทัดใหม่) ส่วน ชื่อพอยน์เตอร์อ้างอิง หมายถึง ชื่อตัวแปรที่ใช้ในการอ้างอิงการเปิดไฟล์ทำงาน แสดงตัวอย่างการเขียนอักขระไปยังไฟล์ ดังนี้

```
01:FILE *fp = fopen("text.txt", "w");  // เปิดไฟล์
02:putc('A', fp);
03:putc('\n', fp);
04:fclose(fp);                              // ปิดไฟล์
```

จากตัวอย่างข้างต้น การใช้คำสั่ง putc('A', fp); เป็นการสั่งให้มีการเขียนตัวอักษร 'A' และขึ้นบรรทัดใหม่ โดยการใช้คำสั่ง putc('\n', fp); ไปยังไฟล์ที่พอยน์เตอร์ fp อ้างอิงอยู่ สำหรับในกรณีที่ต้องการเขียนไฟล์จากค่าตัวแปรประเภทอักขระ มีรูปแบบคำสังดังนี้

```
putc(ชื่อตัวแปรประเภทอักขระ, ชื่อพอยน์เตอร์อ้างอิง);
```

โดย ชื่อตัวแปรประเภทอักขระ เป็นการระบุชื่อตัวแปรที่ถูกประกาศเป็นชนิดแบบอักขระ ส่วน ชื่อพอยน์เตอร์อ้างอิง หมายถึง ชื่อตัวแปรที่ใช้ในการอ้างอิงการเปิดไฟล์ทำงาน โดยตัวอย่างการเขียนค่าตัวแปรอักขระไปยังไฟล์ มีดังนี้

```
01:FILE *fp = fopen("text.txt", "w");     // เปิดไฟล์
02:char ch = 'B';           // ประกาศเป็นชนิดแบบอักขระ ch = 'B'
03:char newline = '\n';   // ประกาศเป็นชนิดแบบอักขระ newline = '\n'
04:putc(ch, fp); 
05:putc(newline, fp);   // เขียนค่าตัวแปรอักขระ newline ที่พอยน์เตอร์fp อ้างอิง
06:fclose(fp);                                // เปิดไฟล์
```

จากตัวอย่างข้างต้น คำสั่ง putc(ch, fp); เป็นการเขียนค่าตัวแปรอักขระ ch ซึ่งมีค่า คือ ตัวอักษร 'B' และเขียนค่าตัวแปรอักขระ newline คือ ตัวอักษร '\n' (ขึ้นบรรทัดใหม่) ไปยังไฟล์ที่พอยน์เตอร์fp อ้างอิงอยู่

#### 2.  คำสั่งอ่านอักขระทีละตัวอักษร
คำสั่ง getc() เป็นคำสั่งที่ใช้อ่านข้อมูลจากไฟล์ครั้งละ 1 ตัวอักขระ โดยมีรูปแบบคำสั่ง ดังนี้

```
getc(ชื่อพอยน์เตอร์อ้างอิง);
```

ตัวอย่างการใช้งานคำสั่งจากรูปแบบคำสั่งข้างต้น  เช่น

```
01:getc(fp);
```

จากตัวอย่างข้างต้น เป็นการอ่านอักขระจำนวน 1 ตัวอักษร จากพอยน์เตอร์อ้างอิงแฟ้มข้อมูล fp 

#### 3.  คำสั่งการเขียนข้อมูลไปยังแฟ้มข้อมูลตามรูปแบบบังคับ
คำสั่ง fprintf() เป็นคำสั่งที่เขียนหรือบันทึกข้อมูลเพื่อจัดเก็บไปยังแฟ้มข้อมูล โดยมีรูปแบบคำสั่ง ดังนี้

```
fprintf(ชื่อพอยน์เตอร์อ้างอิง, "รูปแบบบังคับการอ่าน", รายการตัวแปร …);
```

ตัวอย่างการใช้งานคำสั่งจากรูปแบบคำสั่งข้างต้น  เช่น

```
01:fprintf(fp, "\n%s %d %f", Name, ExpYear, Salary);
```

จากตัวอย่างข้างต้น เป็นการเขียนข้อมูลไปยังแฟ้มข้อมูลที่พอยน์เตอร์ fp อ้างอิงอยู่ โดยเขียนตามรูปแบบ "\n%s %d %f" ด้วยค่าของตัวแปร Name, ExpYear และ Salary ตามลำดับ

#### 4.  การอ่านข้อมูลจากแฟ้มข้อมูลตามรูปแบบบังคับ
คำสั่ง fscanf() เป็นคำสั่งในการอ่านค่าข้อมูลจากแฟ้มข้อมูล โดยมีรูปแบบคำสั่ง ดังนี้

```
fscanf(ชื่อพอยน์เตอร์อ้างอิง, "รูปแบบบังคับการอ่าน", รายการตัวแปร …);
```

ตัวอย่างการใช้งานคำสั่งจากรูปแบบคำสั่งข้างต้น  เช่น

```
01:	fscanf(fp, "%s %d %f\n", Name, &ExpYear, &Salary);
```

จากตัวอย่างข้างต้น เป็นการอ่านข้อมูลที่พอยน์เตอร์ fp อ้างอิงอยู่ ตามรูปแบบ "%s %d %f\n"  ที่มีการจัดเก็บในตัวแปร Name, &ExpYear และ &Salary ตามลำดับ 
ข้อสังเกต ตัวแปรข้อความ Name เป็นตัวแปรแบบอ้างอิงจึงระบุเพียง Name ส่วนตัวแปรอื่นต้องระบุเป็นตำแหน่ง โดยที่ &ExpYear และ &Salary คือ ตำแหน่งในหน่วยความจำของตัวแปร ExpYear และ Salary 

#### 5.  การเขียนข้อมูลแบบโครงสร้างไปยังแฟ้มข้อมูล
คำสั่ง fwrite() เป็นคำสั่งการเขียนข้อมูลตามรูปแบบชนิดโครงสร้างที่ใช้ในการจัดเก็บข้อมูลนั้น ๆ ไปยังแฟ้มข้อมูล มีรูปแบบคำสั่งดังนี้

```
fwrite(&ชื่อตัวแปรโครงสร้าง, ขนาด, รอบการอ่าน,  ชื่อพอยน์เตอร์อ้างอิง);
```

ตัวอย่างการใช้งานคำสั่งจากรูปแบบคำสั่งข้างต้น  เช่น

```
01:fwrite(&emp, sizeof(EMPLOYEE), 1,  fp);
```

จากตัวอย่างข้างต้น เป็นการเขียนข้อมูลตัวแปรโครงสร้าง emp ไปยังแฟ้มข้อมูลที่พอยน์เตอร์ fp อ้างอิงอยู่ จำนวน 1 ครั้ง โดยมีขนาดการเขียนเท่ากับ sizeof(EMPLOYEE) ที่มีการประกาศตามโครงสร้างแบบ EMPLOYEE

#### 6.  การอ่านข้อมูลแบบโครงสร้างจากแฟ้มข้อมูล
คำสั่ง fread() เป็นคำสั่งการอ่านข้อมูลตามรูปแบบชนิดโครงสร้างที่ใช้ในการจัดเก็บข้อมูลนั้น ๆ  มีรูปแบบคำสั่งดังนี้

```
fread(&ชื่อตัวแปรโครงสร้าง, ขนาด, รอบการอ่าน,  ชื่อพอยน์เตอร์อ้างอิง);
```

ตัวอย่างการใช้งานคำสั่งจากรูปแบบคำสั่งข้างต้น  เช่น

```
01:fread(&emp, sizeof(EMPLOYEE), 1,  fp);
```

จากตัวอย่างข้างต้นเป็นการอ่านข้อมูลที่พอยน์เตอร์ fp อ้างอิงอยู่ จำนวน 1 รอบ มีขนาดเท่ากับ sizeof(EMPLOYEE) โดยที่ค่า sizeof(EMPLOYEE) คือ ขนาดตามการประกาศโครงสร้างแบบ EMPLOYEE เพื่อจัดเก็บข้อมูลไปยังตำแหน่งในหน่วยความจำตัวแปรโครงสร้าง emp

---
#### [<< หน้าก่อนหน้า](0802.md) | [หน้าเลือกหัวข้อ](README.md) | [หน้าต่อไป >>](0804.md)
---
