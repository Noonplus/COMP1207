## โครงสร้างแบบยูเนียน
	
โครงสร้างแบบยูเนียนเป็นวิธีการอ้างอิงตัวแปรแบบเดียวกับตัวแปรโครงสร้างทั่วไป แต่จะมีการจัดสรรพื้นที่ให้กับตัวแปรภายในโครงสร้างได้ใช้เนื้อที่ร่วมกัน โดยพื้นที่จัดสรรสูงสุดจะเท่ากับขนาดของตัวแปรที่มีขนาดใหญ่ที่สุดในโครงสร้าง โครงสร้างแบบยูเนียนมีรูปแบบคำสั่ง ดังนี้

```
union {
    ชนิดตัวแปร ชื่อตัวแปรที่ 1;
    ชนิดตัวแปร ชื่อตัวแปรที่ 2;
    ชนิดตัวแปร ชื่อตัวแปรที่ n;
} ชื่อตัวแปรยูเนียน;
```

ตัวอย่างการเขียนโครงสร้างแบบยูเนียน มีดังนี้

```
01:union {
02:   int i;
03:   float f;
04:   char c;
05:} u;
```

จากตัวอย่างข้างต้น ตัวแปร u มีโครงสร้างแบบยูเนียน ที่ใช้พื้นที่ในการทำงานเท่ากับขนาดของตัวแปรจำนวนจริง f ซึ่งมีขนาดเท่ากับ 4 ไบต์ อธิบายได้ดังภาพ

<img src=img/0705.png>

จากภาพโครงสร้างยูเนียน u ประกอบไปด้วยตัวแปรในโครงสร้าง 3 ตัวแปร ได้แก่ ตัวแปรจำนวนเต็ม i (2 ไบต์) ตัวแปรจำนวนจริง f (4 ไบต์) และ ตัวแปรอักระ c (1 ไบต์) ตัวแปรทั้งหมดมีขนาดรวมกัน เท่ากับ 7 ไบต์ แต่โครงสร้างยูเนียนจะจัดสรรพื้นให้ใช้พื้นที่หน่วยความจำน้อยลงโดยจัดสรรพื้นที่เท่ากับตัวแปรเพียงตัวเดียวที่มีขนาดใหญ่ที่สุดเท่านั้น คือ ขนาด 4 ไบต์ ดังนั้น ตัวแปรทั้งหมดที่อยู่ในโครงสร้างแบบยูเนียนจะต้องใช้พื้นที่ในหน่วยความจำต่างเวลากันไม่สามารถใช้พื้นที่พร้อมกันได้ โครงสร้างแบบยูเนียน สามารถนำไปจัดการการใช้พื้นที่ของโครงสร้างข้อมูลให้ใช้พื้นที่หน่วยความจำร่วมกันได้อย่างประหยัด เนื่องจากในสถานการณ์ทำงานจริงโครงสร้างที่มีอยู่อาจจะไม่ได้ถูกใช้งานพร้อมกัน ดังนั้น การประกาศโครงสร้างข้อมูลให้อยู่ภายใต้โครงสร้างแบบยูเนียนจะทำให้เกิดการใช้พื้นที่หน่วยความจำร่วมกัน ซึ่งพื้นที่ในการทำงานจะถูกจัดสรรไว้ให้เท่ากับขนาดของโครงสร้างภายในยูเนียนที่ใหญ่ที่สุด มีรูปแบบการเขียน ดังนี้

```
union {
          struct {
              ชนิด ชื่อตัวแปรในโครงสร้าง 1 ตัวที่ 1;
              ชนิด ชื่อตัวแปรในโครงสร้าง 1 ตัวที่ 2;
                  …
          } ชื่อตัวแปรโครงสร้าง 1;
          struct {
             ชนิด ชื่อตัวแปรในโครงสร้าง 2 ตัวที่ 1;
             ชนิด ชื่อตัวแปรในโครงสร้าง 2 ตัวที่ 2;
                  …
          } ชื่อตัวแปรโครงสร้าง 2;
          ...
} ชื่อตัวแปรยูเนียน;
```

ตัวอย่างการเขียนโครงสร้างแบบยูเนียนข้างต้น มีดังนี้ 

```
01:union  {
02:	struct {
03:		char name[50];
04:		char faculty[100];
05:	};
06:	struct {
07:		char university[100];
08:		char address[100];
09:	};
10:} u;
```

จากตัวอย่าง ตัวแปร u มีโครงสร้างแบบยูเนียน ใช้พื้นที่ในการทำงานเท่ากับขนาดของโครงสร้างภายในที่ใหญ่ที่สุด คือ u มีขนาด 200 ไบต์ อธิบายได้ดังภาพ

<img src=img/0706.png>

ตามภาพแสดงการจัดการพื้นที่ของโครงสร้าง จำนวน 2 โครงสร้าง ที่อยู่ภายใต้แบบยูเนียนดังกล่าว ซึ่งโครงสร้างทั้งสองไม่สามารถใช้พื้นที่พร้อมกันได้จะต้องใช้พื้นที่ดังกล่าวต่างเวลากัน ดังนั้น ตัวอย่างการเขียนโครงสร้างแบบยูเนียนเพื่อจัดการการใช้พื้นที่ของโครงสร้างข้อมูล ดังนี้

```
01:#include <stdio.h> 
02:#include <string.h> 
03:main() { 
04:	union {
05:		struct {
06:			char name[50];
07:			char faculty[100];
08:		};
09:		struct {
10:			char university[100];
11:			char address[100];
12:		};
13:	} u;                                       
14:	strcpy(u.name, "Tony Stark");
15:	strcpy(u.faculty, " Information Systems and Technology");
16:	printf("Name: %s\n", u.name);
17:	printf("Address1: %s\n", u.faculty);
18:	strcpy(u.university, "Massachusetts Institute of Technology");
19:	strcpy(u.address, "77 Massachusetts Ave, Cambridge, MA 02139, USA");
20:	printf("University: %s\n", u.university); 
21:	printf("Address2: %s", u.address); 
22:}
```
[ดาวน์โหลด source code](src/ch07_07.cpp)

ผลการทำงานของโปรแกรม ดังนี้

```
01:Name: Tony Stark
02:Address1: Information Systems and Technology
03:University: Massachusetts Institute of Technology
04:Address2: 77 Massachusetts Ave, Cambridge, MA 02139, USA	
```

---
#### [<< หน้าก่อนหน้า](0704.md) | [หน้าเลือกหัวข้อ](README.md) | [หน้าต่อไป >>](0710.md)
---
