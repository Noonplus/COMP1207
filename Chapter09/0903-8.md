## ตัวอย่างการพัฒนาโปรแกรมพื้นฐานทางธุรกิจ (ต่อ)
### การตัดสินใจในการลงทุน-วิธีพิจารณาจากอัตราผลตอบแทนจากการลงทุน
อัตราผลตอบแทนจากการลงทุน (Internal Rate of Return : IRR) เป็นการคำนวณค่าอัตราคิดลด (Discount Rate) จากการลงทุน โดยอัตราผลตอบแทนนี้จะทำให้มูลค่าปัจจุบันสุทธิมีค่าเท่ากับศูนย์ (NPV = 0) ซึ่งจะแสดงให้เห็นว่าอัตราผลตอบแทนที่แท้จริงจะมีค่าเท่าไหร่ (เฉลิมขวัญ ครุธบุญยงค์. 2556) โดยเกณฑ์การพิจารณาการลงทุนจะพิจารณาค่า IRR เทียบกับต้นทุนทางการเงิน ได้แก่ อัตราดอกเบี้ยเงินกู้ธนาคาร ซึ่งถ้าค่า IRR มีค่ามากกว่าดอกเบี้ยเงินกู้มากเท่าไหร่แสดงถึงความคุ้มค่าในการลงทุนที่สูงขึ้น ตัวอย่างการคำนวณอัตราผลตอบแทนจากการลงทุนจะใช้ข้อมูลกระแสเงินสดสุทธิ (Net Cash Flow) ที่คำนวณได้จากการทดสอบโปรแกรมก่อนหน้า มาจัดเก็บในรูปแบบอาเรย์เพื่อเป็นข้อมูลนำเข้าที่ใช้ประเมินค่าอัตราผลตอบแทนการลงทุน (IRR) โดยได้ทำการวิเคราะห์เพิ่มเติมแสดงรายละเอียดตามตาราง

| ส่วนนำเข้า | กระบวนการ | ผลลัพธ์ |
| --- | --- | --- |
| - กระแสเงินสดสุทธิ (NetCashFlow) | - การประมาณการหาค่าอัตราผลตอบแทนการลงทุน (IRR) | - อัตราผลตอบแทนการลงทุน (IRR) |
| - จำนวนรายการที่คำนวณ (nFlow) |  |  |

จากตาราง แสดงถึงการวิเคราะห์เพื่อประเมินการลงทุนด้วยค่าอัตราผลตอบแทนการลงทุน ซึ่งจะเป็นการต่อยอดจากส่วนกระแสเงินสดสุทธิ (NetCashFlow) ที่เป็นตัวแปรนำเข้าสู่ฟังก์ชันคำนวณค่าการประมาณการหาค่าอัตราผลตอบแทนการลงทุน (IRR) และจะนำไปพิจารณาประกอบกับมูลค่าปัจจุบันสุทธิ (NPV) ที่ได้ทำการประมาณการจากโปรแกรมก่อนหน้านี้ โดยสามารถเขียนเป็นผังโปรแกรมได้ดังภาพ

<img src=img/0908.png>

จากภาพ แสดงผังโปรแกรมวิธีการหาอัตราผลตอบแทนการลงทุน ซึ่งมีรายละเอียดขั้นตอนวิธีการทำงาน ดังนี้

1.	ประกาศตัวแปรและกำหนดค่าเริ่มต้น ได้แก่ อัตราผลตอบแทนการลงทุน (IRR = 0.00) 
2.	รับเข้าค่าตัวแปรชุดข้อมูลแบบอาเรย์กระแสเงินสดสุทธิ (NetCashFlow) และ จำนวนปีที่จะคำนวณค่า IRR (nFlow)
3.	คำนวณค่าอัตราผลตอบแทนการลงทุน (IRR) ด้วยฟังก์ชัน  IRR = getIRR(NetCashFlow, nFlow)
4.	แสดงผลค่าอัตราผลตอบแทนการลงทุน (IRR)

ด้วยฟังก์ชันที่ใช้หาค่า IRR เป็นฟังก์ชันที่มีใช้ในโปรแกรมทั่วไป ดังนั้น ผู้ใช้สามารถพิจารณาจากฟังก์ชัน IRR ที่เตรียมไว้ให้ในรูปแบบภาษาซีพลัสพลัส เพื่อสามารถนำไปประยุกต์ใช้งานต่อยอดสำหรับโปรแกรมที่เกี่ยวข้องกับการตัดสินใจในการลงทุนต่าง ๆ ในที่นี้ขอแสดงตัวอย่างการเขียนโปรแกรมและการสร้างฟังก์ชัน IRR ด้วยภาษาซีพลัสพลัส ดังโปรแกรม

```
#include <stdio.h>
#include <math.h>
#define LOW_RATE 0.01
#define HIGH_RATE 0.5
#define MAX_ITERATION 1000
#define PRECISION_REQ 0.00000001
double getIRR(double NetCashFlow[], int nFlow);
int main() {
     double NetCashFlow[] = {-1000000.0000, 31999.9922, 31999.9922, 
                31999.9922, 31999.9922, 31999.9922, 2000000.0000};
    double IRR = 0.00;
     int nFlow = 7;
     IRR = getIRR(NetCashFlow, nFlow);
     printf("IRR: %.4f percent", IRR*100);
}
double getIRR(double NetCashFlow[], int nFlow) {
     int i = 0, j = 0;
     double m = 0.00;
     double old = 0.00;
     double n = 0.00;
     double oldguessRate = LOW_RATE;
     double newguessRate = LOW_RATE;
     double guessRate = LOW_RATE;
     double lowGuessRate = LOW_RATE;
     double highGuessRate = HIGH_RATE;
     double NPV = 0.00;
     double denom = 0.00;
     for(i=0; i<MAX_ITERATION; i++) {
        NPV = 0.00;
        for(j=0; j<nFlow; j++) {
           denom = pow((1 + guessRate),j);
           NPV = NPV + (NetCashFlow[j]/denom);
        } 
          if((NPV > 0) && (NPV < PRECISION_REQ))
            break;
            if(old == 0)
                old = NPV;
            else
                old = n;
            n = NPV;
          if(i > 0) {
               if(old < n) {
                    if(old < 0 && n < 0)
                        highGuessRate = newguessRate;
                    else
                        lowGuessRate = newguessRate;
               }else {
                    if(old > 0 && n > 0)
                        lowGuessRate = newguessRate;
                    else
                        highGuessRate = newguessRate;
               }
          }
          oldguessRate = guessRate;
          guessRate = (lowGuessRate + highGuessRate) / 2;
          newguessRate = guessRate;
     }
     return guessRate;
}
```
[ดาวน์โหลด source code](src/ch09_08.cpp)

หมายเหตุ: ได้ปรับใช้ฟังก์ชันในการประมาณการอัตราผลตอบแทนการลงทุน (IRR) จากลิงค์ 
https://www.codeproject.com/Tips/461049/Internal-Rate-of-Return-IRR-Calculation 
(ออนไลน์, 2560)

จากโปรแกรม ได้กำหนดค่าส่วนเป็นรายการกระแสเงินสดสุทธิที่ประเมินได้จากโปรแกรมที่ 9.6 ในรูปแบบอาเรย์ คือ NetCashFlow[] = {-1000000.0000, 31999.9922, 31999.9922, 31999.9922, 31999.9922, 31999.9922, 2000000.0000}; เมื่อโปรแกรมประมวลผลด้วยฟังก์ชัน getIRR(double NetCashFlow[], int nFlow) ที่เตรียมไว้ให้ จะได้ค่าอัตราผลตอบแทนการลงทุน (IRR) ดังปรากฏผลลัพธ์บนจอภาพ ดังนี้

```
IRR: 14.4210 percents
```

จากผลลลัพธ์ของโปรแกรม แสดงค่าอัตราผลตอบแทนการลงทุน (IRR) มีค่าเท่ากับ 14.4210% ซึ่งมากกว่าอัตราดอกเบี้ยธนาคารที่ประมาณจาก[โปรแกรมประมาณการกระแสเงินสดสุทธิ](src/ch09_06.cpp) ไว้ที่ 6% ดังนั้น จากการคำนวณแสดงให้เห็นถึงความเป็นไปได้ในการลงทุนที่คุ้มค่า

---
#### [<< หน้าก่อนหน้า](0903-7.md) | [หน้าเลือกหัวข้อ](README.md) | [หน้าต่อไป >>](0910.md)
---
