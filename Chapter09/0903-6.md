## ตัวอย่างการพัฒนาโปรแกรมพื้นฐานทางธุรกิจ (ต่อ)
### การประมาณกระแสเงินสดสุทธิ
การประมาณการกระแสเงินสดเป็นกระบวนการประเมินกระแสเงินสดที่จะได้รับจากโครงการลงทุน (เฉลิมขวัญ ครุธบุญยงค์. 2556) ซึ่งโครงการการลงทุนมีอยู่หลายรูปแบบเพื่อให้เข้าใจหลักการคิดเรื่องกระแสเงินสุทธิที่จะใช้เป็นตัวแปรนำเข้าระบบ ในที่นี้ขอยกตัวอย่างการซื้อขายอสังหาริมทรัพย์ในรูปของอาคารพาณิชย์ที่มีราคา 1,800,000 บาท โดยใช้เงินสดจำนวน 1,000,000 บาท ส่วนที่เหลือได้ผ่อนกับธนาคารเป็นระยะเวลา 5 ปี ด้วยอัตราดอกเบี้ยคงที่ 6% ต่อปี (ประมาณ 17,400 ต่อเดือน) ซึ่งอาคารพานิชย์ดังกล่าวถูกปล่อยให้เช่าในราคาเดือนละ 20,000 บาท ตามระยะเวลาที่ผ่อนค่างวด ซึ่งหลังจากผ่อนชำระงวดสุดท้ายได้ขายอาคารพานิชย์ในราคา 2,000,000 บาท จากรายละเอียดดังกล่าว สามารถวิเคราะห์เพื่อสร้างโปรแกรมคำนวณบัญชีกระแสเงินสดได้ ดังตาราง

| ส่วนนำเข้า | กระบวนการ | ผลลัพธ์ |
| --- | --- | --- |
| - ราคาซื้อเงินสด (Price) | - ประมวลผลยอดสำหรับจัดไฟแนนซ์ | - กระแสเงินสดสุทธิ |
| - กระแสเงินสดจ่ายครั้งแรก (CF_int) | - ประมวลผลกระแสเงินสดจ่ายต่อเดือนหรือค่างวด (CF_payment) | - มูลค่าสะสมหรือกำไรสะสม |
| - อัตราดอกเบี้ยเกินกู้ (rate) | - ประมวลผลกระแสเงินสดสุทธิ |  |
| - ระยะเวลาในการผ่อนชำระ (n) | - ประมวลผลมูลค่าสะสม |  |
| - รายได้ที่คาดว่าจะได้รับต่อเดือน (CF_receive) |  |  |
| - ราคาที่ต้องการขายออกหลังจากผ่อนชำระงวดสุดท้าย (CF_final) |  |  |

จากตาราง แสดงการวิเคราะห์เพื่อประมาณการกระแสเงินสดสุทธิและมูลค่าสะสม โดยได้กำหนดส่วนนำเข้าของกระบวนการ ได้แก่ ราคาซื้อสด (Price) กระแสเงินสดจ่ายครั้งแรก (CF_int) อัตราดอกเบี้ยเกินกู้ (rate) ระยะเวลาในการผ่อนชำระ (n) รายได้ที่คาดว่าจะได้รับต่อเดือน (CF_receive) และ ราคาที่ต้องการขายออกหลังจากผ่อนชำระงวดสุดท้าย (CF_final) ส่วนนำเข้าจะถูกนำไปใช้ประมวลผลเพื่อสร้างเป็นตารางแสดงรายละเอียดกระแสเงินสด โดยมีการกำหนดส่วนผลลัพธ์ คือ กระแสเงินสดสุทธิ และมูลค่าสะสมหรือกำไรสะสม โดยสามารถเขียนเป็นผังโปรแกรมได้ดังภาพ

<img src=img/0906.png>

จากภาพ แสดงผังงานโปรแกรมประมาณการกระแสเงินสดสุทธิและมูลค่าสะสม ซึ่งมีรายละเอียดขั้นตอนวิธีการทำงาน ดังนี้
1.  กำหนดค่าเริ่มต้นให้กับตัวแปรต่าง ๆ ได้แก่ ราคา (Price = 0.00) เงินสดจ่ายครั้งแรก (CF_int = 0.00) ค่างวด (CF_payment = 0.00) เงินสดขายออกที่ต้องการหลังผ่อนชำระงวดสุดท้ายเสร็จสิ้น (CF_final = 0.00) อัตราดอกเบี้ยธนาคาร (Rate = 0.00) รายได้ที่เกิดจากการลงทุน เช่น การให้เช่าต่อ (CF_recive = 0.00) ตัวแปรเพื่อเก็บมูลค่ากระแสเงินสดสะสม (CF_comulative = 0.00) และจำนวนปีที่ผ่อนชำระค่างวด (n = 0)
2.  รับเข้าค่าตัวแปรราคาซื้อเงินสด (Price) และกระแสเงินสดการจ่ายชำระครั้งแรกหรือเงินดาวน์ (CF_int) 
3.  กำหนดค่าตัวแปรกระแสเงินสดสะสม CF_comulative = - CF_int
4.  รับเข้าค่าตัวแปรอัตราดอกเบี้ยที่ต้องการ (rate) และจำนวนปีในการผ่อนชำระในส่วนที่เหลือ (n)
5.  คำนวณค่างวดชำระต่อเดือนด้วยคำสั่ง CF_payment = getCF_payment(Price, CF_int, rate, n)
6.  รับเข้าค่าตัวแปรอัตราดอกเบี้ยเงินกู้ (rate) และ จำนวนปีในการผ่อนชำระในส่วนที่เหลือ (n)
7.  แสดงรายการ (Statement) กระแสเงินสดในปีที่ 0 (เริ่มลงทุน)
8.  วนรอบจำนวนปีที่ผ่อนค่างวดเริ่มตั้งแต่ปีที่ 1 ถึงปีที่ n

      8.1 ถ้ายังไม่ครบ n ปี

    (1) คำนวนตัวแปรกระแสเงินสดสะสม (CF_comulative) ของปี

    (2) แสดงรายการ (Statement) กระแสเงินสดของปี

      8.2 ถ้าครบปี จบการวนรอบ

9.  แสดงรายการ (Statement) กระแสเงินสดในปีที่ n+1 (ขายออก)
  
จากขั้นตอนวิธีข้างต้น สามารถนำไปเขียนโปรแกรมด้วยภาษาซีพลัสพลัสได้ ดังนี้ 

```
#include <stdio.h>
#include <conio.h>
float getCF_payment(float Price, float CF_int, float rate, int n);
main() {
    float Price, CF_int, CF_payment, CF_final, CF_recive, CF_comulative;
    float rate; int n;
    printf("Net Cash Flow Calculator\n");
    printf("Input Net Price:"); scanf("%f", &Price);
    printf("An initial payment (BAHT):"); scanf("%f", &CF_int);
    CF_comulative = -CF_int;
    printf("Take out a loan (BAHT): %.0fB\n", (Price-CF_int));
    printf("Input Interest Rate (percent):"); scanf("%f", &rate);
    printf("Input number of year for payment:"); scanf("%d", &n);
    CF_payment = getCF_payment(
.Price, CF_int, rate, n);
    printf("Monthly Payment (BAHT): %.4f\n", CF_payment);
    printf("Input Interest Income for Receive per Month (BAHT):"); 
    scanf("%f", &CF_recive);
    printf("Input Interest Net Price for Sell after Final Payment (BAHT):");
    scanf("%f", &CF_final);
    printf("STATEMENT\n");
    printf("%5s %20s %20s %20s %20s\n", "Year", "Cash Flow (Pay)", 
              "Cash Flow (Receive)", "Net Cash Flow", "Comulative CF");
    printf("%5d %20.4fB %20.4fB %20.4fB %20.4fB\n", 0, -CF_int, 0.0000, 
             -CF_int, CF_comulative);
for(int i = 1; i<=n; i++) {
        CF_comulative = CF_comulative+(CF_recive*12-CF_payment*12);
         printf("%5d %20.4fB %20.4fB %20.4fB %20.4fB\n", i, 
            -CF_payment*12, CF_recive*12, CF_recive*12-CF_payment*12, 
           CF_comulative);
    }
    CF_comulative = CF_comulative+CF_final;
    printf("%5d %20.4fB %20.4fB %20.4fB %20.4fB\n", n+1, 0.0000, 
             CF_final, CF_final, CF_comulative);
}
float getCF_payment(float Price, float CF_int, float rate, int n) {
    return ((Price-CF_int)+(((Price-CF_int)*(rate/100))*n))/(n*12);
}
```
[ดาวน์โหลด source code](src/ch09_06.cpp)

จากโปรแกรม ได้ทดสอบและจำลองสถานการณ์ตัวอย่างการลงทุนซื้ออาคารในราคา 1,800,000 บาท โดยมีเงินสดลงทุนจำนวน 1,000,000 บาท ส่วนที่เหลือได้ผ่อนชำระกับธนาคารโดยมีอัตราดอกเบี้ยเงินกู้คงที่ 6% ต่อปี ใช้ระยะเวลาผ่อนชำระจำนวน 5 ปี ระหว่างการผ่อนชำระได้ปล่อยให้เช่าเดือนละ 20,000 บาท โดยเมื่อผ่อนชำระงวดสุดท้ายเสร็จสิ้น ได้ทำการขายออกในราคา 2,000,000 บาท โดยผลลัพธ์การทำงานของโปรแกรมปรากฏบนจอภาพ ดังนี้

```
Net Cash Flow Calculator
Input Net Price:1800000
An initial payment (BAHT):1000000
Take out a loan (BAHT): 800000B
Input Interest Rate (percent):6
Input number of year for payment:5
Monthly Payment (BAHT): 17333.3340
Input Interest Income for Receive per Month (BAHT):20000
Input Interest Net Price for Sell after Final Payment (BAHT):2000000
STATEMENT
Year Cash Flow (Pay) Cash Flow (Receive)      Net Cash Flow        Comulative CF
  0   -1000000.0000B          0.0000B     -1000000.0000B   -1000000.0000B
  1    -208000.0078B     240000.0000B       31999.9922B    -968000.0000B
  2    -208000.0078B     240000.0000B       31999.9922B    -936000.0000B
  3    -208000.0078B     240000.0000B       31999.9922B    -904000.0000B
  4    -208000.0078B     240000.0000B       31999.9922B    -872000.0000B
  5    -208000.0078B     240000.0000B       31999.9922B    -840000.0000B
  6     0.0000B          2000000.0000B      2000000.0000B   1160000.0000B
```

จากผลลัพธ์ข้างต้น โปรแกรมคำนวณยอดเงินกู้ที่ 800,000 บาท โดยต้องผ่อนชำระเดือนละ 17,333.3340 บาท ในอัตราดอกเบี้ยคงที่ 6% และระยะเวลา 5 ปี ตามที่กำหนดไว้ จากกระแสเงินสดรายจ่ายที่เกิดขึ้นรวมกับกระแสเงินสดรายรับที่ได้จากค่าเช่า โปรแกรมทำการคำนวณและแสดงผลออกมาในรูปแบบบัญชีกระแสเงินสดสุทธิในแต่ละปี (Net Cash Flow) พร้อมกับการแสดงมูลค่าเงินสดสะสม (Comulative CF) เพื่อให้นักลงทุนใช้เป็นข้อมูลประกอบการพิจารณาผลการดำเนินงาน จากกรณีดังกล่าวพบว่า จากการลงทุนเริ่มต้นที่ 1,000,000 บาท ภายในระยะเวลาประมาณ 5 ปี นักลงทุนจะได้เงินสดกลับมามูลค่า 1,160,000 บาท 

---
#### [<< หน้าก่อนหน้า](0903-5.md) | [หน้าเลือกหัวข้อ](README.md) | [หน้าต่อไป >>](0903-7.md)
---

